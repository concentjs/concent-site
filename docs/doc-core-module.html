<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>模块的定义 · concent</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;hr&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="模块的定义 · concent"/><meta property="og:type" content="website"/><meta property="og:url" content="https://concentjs.github.io/concent-site/concent-site/"/><meta property="og:description" content="&lt;hr&gt;
"/><meta property="og:image" content="https://concentjs.github.io/concent-site/concent-site/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://concentjs.github.io/concent-site/concent-site/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/concent-site/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://concentjs.github.io/concent-site/concent-site/blog/atom.xml" title="concent Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://concentjs.github.io/concent-site/concent-site/blog/feed.xml" title="concent Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/concent-site/css/main.css"/><script src="/concent-site/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/concent-site/"><img class="logo" src="/concent-site/img/favicon.ico" alt="concent"/><h2 class="headerTitleWithLogo">concent</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/concent-site/docs/doc-intro-what-is-concent" target="_self">Docs</a></li><li class=""><a href="/concent-site/docs/api-top-run" target="_self">API</a></li><li class=""><a href="/concent-site/docs/release-v1-1-26" target="_self">发布日志</a></li><li class=""><a href="/concent-site/help" target="_self">Help</a></li><li class=""><a href="/concent-site/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>核心概念与功能</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">序言</h3><ul class=""><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-intro-what-is-concent">concent是什么</a></li><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-intro-compare-others">对比redux和mobx</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">新手指南</h3><ul class=""><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-guid-quick-start">快速开始</a></li><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-guid-progressive-dev">渐进式的开发</a></li><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-guid-standard-dev">标准化的开发</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">核心概念与功能</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/concent-site/docs/doc-core-module">模块</a></li><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-core-component">组件</a></li><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-core-reducer">reducer</a></li><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-core-debug">调试</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">生态与周边</h3><ul class=""><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-eco-router">react-router-concent</a></li><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-eco-loading">concent-loading</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">精彩示例</h3><ul class=""><li class="navListItem"><a class="navItem" href="/concent-site/docs/doc-case-antd-pro">concent-antd-pro</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">模块的定义</h1></header><article><div><span><hr>
<p>模块是一个很重要的概念，一个应用程序随着不停的迭代一定会变得越来越复杂， 为了同时满足<b>容易维护</b>、<b>方便扩展</b>、<b>适合多人协同开发</b>这些特点，我们通常都会按照<code>领域对象</code>或者<code>业务模型</code>将我们庞大的应用拆分为各个模块，<code>concent</code>经过整合现有各个UI框架的最佳实践，为模块提炼出了5个核心的概念</p>
<ul>
<li><code>state</code></li>
<li><code>reducer</code></li>
<li><code>init</code></li>
<li><code>computed</code></li>
<li><code>watch</code>
<img src="/concent-site/img/cc-module.png" alt="模块">
我们使用<a href="api-top-run">run</a>函数启动<code>concent</code>时，载入的就是各个模块定义，然后通过提供<a href="api-top-register">register</a>、<a href="api-top-connect">connect</a>、<a href="api-top-connect-dumb">connectDumb</a>函数让用户可以很方便的将ui与模块关联起来</li>
</ul>
<blockquote>
<p>模块是独立于组件存在的，用户根据自己的实际情况按需连接组件与模块</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="state"></a><a href="#state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>state</h2>
<p>状态是react里非常重要的概念，它的变化驱动着视图的变化，同样的，状态也是<code>concent</code>模块里必不可少的配置，我们定义一个模块时，可以缺省<code>reducer</code>、<code>computed</code>、<code>watch</code>、<code>init</code>，唯独不能缺省<code>state</code>的定义</p>
<h3><a class="anchor" aria-hidden="true" id="状态定义"></a><a href="#状态定义" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>状态定义</h3>
<p><a href="https://stackblitz.com/edit/cc-course-define-state?file=index.js">在线示例</a></p>
<p>定义好<code>foo</code>模块的状态后，使用<a href="api-top-run">run</a>载入<code>foo</code>模块，使用<a href="api-top-register">register</a>将react类注册成为concent类并指定其属于<code>foo</code>模块</p>
<pre><code class="hljs"><span class="hljs-keyword">import</span> <span class="hljs-type">React</span> from <span class="hljs-symbol">'reac</span>t';
<span class="hljs-keyword">import</span> <span class="hljs-type">ReactDOM</span> from <span class="hljs-symbol">'react</span>-dom';
<span class="hljs-keyword">import</span> { run, register } from <span class="hljs-symbol">'concen</span>t';


run({
  foo: {<span class="hljs-comment">//定义foo模块</span>
    state: {<span class="hljs-comment">//为foo模块定义state</span>
      label:<span class="hljs-symbol">'hello</span> concent'
    },
  },
});

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
  render(){
    const label = <span class="hljs-keyword">this</span>.state.label;
    <span class="hljs-keyword">return</span> (
      &lt;div&gt;
        {label}&lt;br/&gt;
        &lt;input value={label} onChange={<span class="hljs-keyword">this</span>.$$sync(<span class="hljs-symbol">'labe</span>l')} /&gt;
      &lt;/div&gt;
    )
  }
}
const <span class="hljs-type">App_</span> = register(<span class="hljs-symbol">'Ap</span>p', {module:<span class="hljs-symbol">'fo</span>o', sharedStateKeys:'*'})(<span class="hljs-type">App</span>);
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="状态合成"></a><a href="#状态合成" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>状态合成</h3>
<p>上述示例中，我们并没有在<code>constructor</code>里声明过<code>state</code>，<code>render</code>函数里却直接从<code>state</code>里获取到<code>label</code>的值，是因为我们将<code>App</code>注册到<code>foo</code>模块了，<code>concent</code>在<code>componentWillMount</code>阶段自动将模块的<code>state</code>注入到实例上，实际上，你也可以显示的在<code>constructor</code>声明其他的状态，这并不妨碍的<code>concent</code>的正常运行，<code>concent</code>在实例首次<code>render</code>将指定模块的状态和用户自定义的状态合成到实例的<code>state</code>里。</p>
<p><a href="https://stackblitz.com/edit/cc-course-define-state-zjywcb?file=index.js">在线示例</a></p>
<pre><code class="hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
 constructor(props, context){
   <span class="hljs-keyword">super</span>(props, context);
   <span class="hljs-keyword">this</span>.state = { myLabel:<span class="hljs-symbol">'my</span> <span class="hljs-keyword">private</span> label' };
 }
 render(){
   const {label, myLabel} = <span class="hljs-keyword">this</span>.state;
   <span class="hljs-keyword">return</span> (
     &lt;div&gt;
       label:{label}&lt;br/&gt;
       myLabel:{myLabel}&lt;br/&gt;
       &lt;input value={label} onChange={<span class="hljs-keyword">this</span>.$$sync(<span class="hljs-symbol">'labe</span>l')} /&gt;
     &lt;/div&gt;
   )
 }
}
const <span class="hljs-type">App_</span> = register(<span class="hljs-symbol">'Ap</span>p', {module:<span class="hljs-symbol">'fo</span>o', sharedStateKeys:'*'})(<span class="hljs-type">App</span>);
</code></pre>
<blockquote>
<p>render里，我们取到了<code>label</code>、<code>myLabel</code>两个值，<code>label</code>来自于<code>foo</code>模块，<code>myLabel</code>来自于我们在狗朝气里的自定义值!<br/>
如果在我们在构造器里定义<code>label</code>值为'see what happen'，render里依然取到的是'hello concent'，<code>concent</code>总是会用模块里的状态覆盖掉用户的自定义状态，如果出现同名的key的话。</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="状态连接"></a><a href="#状态连接" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>状态连接</h3>
<p>上述示例中，我们定义<code>App</code>专属于<code>foo</code>模块，如果我们新增两个模块<code>bar</code>、<code>baz</code>，让<code>App</code>也能够读取到新增模块的值的话，定义<code>connect</code>属性，表示<code>App</code>还要连接其他的模块</p>
<p><a href="https://stackblitz.com/edit/cc-course-connect-state-in-register">在线示例</a></p>
<pre><code class="hljs">run({
  foo: {//定义foo模块
    <span class="hljs-keyword">state</span>: {//为foo模块定义<span class="hljs-keyword">state</span>
      <span class="hljs-keyword">label</span>:'hello concent'
    },
  },
  bar:{//定义bar模块
    <span class="hljs-keyword">state</span>:{
      barProp1: 'barProp1',
    }
  },
  baz:{//定义baz模块
    <span class="hljs-keyword">state</span>:{
      bazProp1: 'bazProp1',
    }
  }
});

class App extends React.Component{
  render(){
    const <span class="hljs-keyword">label</span> = this.<span class="hljs-keyword">state</span>.<span class="hljs-keyword">label</span>;
    const {bar, baz} = this.$<span class="hljs-variable">$connectedState</span>;
    return (
      <span class="hljs-variable">&lt;div&gt;</span>
        {<span class="hljs-keyword">label</span>}<span class="hljs-variable">&lt;br/&gt;</span>
        {bar.barProp1}<span class="hljs-variable">&lt;br/&gt;</span>
        {baz.bazProp1}<span class="hljs-variable">&lt;br/&gt;</span>
        <span class="hljs-variable">&lt;input value={label} onChange={this.$$sync('label')} /&gt;</span>
        <span class="hljs-variable">&lt;input value={bar.barProp1} onChange={this.$$sync('bar/barProp1')} /&gt;</span>
      &lt;/div&gt;
    )
  }
}
const App_ = register('App', {
  module:'foo', 
  sharedStateKeys:'*', 
  connect:{bar:'*', baz:'*'}, //连接bar模块和baz模块
})(App);
</code></pre>
<p>当然我们也可以注册的时候不指定concent类属于任何任何模块，直接使用<code>connect</code>定义来帮助用户获取<code>store</code>各个模块的数据</p>
<p><a href="https://stackblitz.com/edit/cc-course-connect-all-state">在线示例</a></p>
<pre><code class="hljs">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
  render(){
    const {foo, bar, baz} = <span class="hljs-keyword">this</span>.$$connectedState;
    <span class="hljs-keyword">return</span> (
      &lt;div&gt;
        {foo.label}&lt;br/&gt;
        {bar.barProp1}&lt;br/&gt;
        {baz.bazProp1}&lt;br/&gt;
        &lt;input value={foo.label} onChange={<span class="hljs-keyword">this</span>.$$sync(<span class="hljs-symbol">'foo</span>/label')} /&gt;
        &lt;input value={bar.barProp1} onChange={<span class="hljs-keyword">this</span>.$$sync(<span class="hljs-symbol">'bar</span>/barProp1')} /&gt;
      &lt;/div&gt;
    )
  }
}
const <span class="hljs-type">App_</span> = register(<span class="hljs-symbol">'Ap</span>p', {
  connect:{foo:'*', bar:'*', baz:'*'}, <span class="hljs-comment">//连接foo模块,bar模块和baz模块</span>
})(<span class="hljs-type">App</span>);
</code></pre>
<blockquote>
<p>此时所有的模块状态都从<code>this.$$connectedState</code>上获取了，如果一个类不属于任何模块，同时也要连接多个模块，可以使用<code>connect</code>方法代替<code>register</code>方法</p>
</blockquote>
<pre><code class="hljs"><span class="hljs-keyword">import</span> { <span class="hljs-built_in">connect</span> } from <span class="hljs-string">'concent'</span>;
<span class="hljs-keyword">const</span> App_ = <span class="hljs-built_in">connect</span>(<span class="hljs-string">'App'</span>, {foo:<span class="hljs-string">'*'</span>, bar:<span class="hljs-string">'*'</span>, baz:<span class="hljs-string">'*'</span>} )(App);
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="状态修改"></a><a href="#状态修改" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>状态修改</h3>
<p>对比react类，concent类扩展了很多特性，如上述示例中，你可能留意到了<code>this.$$sync</code>的写法，但是如果你不需要用到它们，或者在你没有了解它们之前，你依然可以按照最古典的react写法类书写你的代码，唯一不同的只是，状态被提升到了<code>store</code>的某个模块下</p>
<p><a href="https://stackblitz.com/edit/cc-course-classic-writing-in-concent-class?file=index.js">在线示例</a></p>
<pre><code class="hljs">import React <span class="hljs-keyword">from</span> 'react';
import { run, register } <span class="hljs-keyword">from</span> 'concent';

run({
  foo: {//定义foo模块
    <span class="hljs-keyword">state</span>: {//为foo模块定义<span class="hljs-keyword">state</span>
      <span class="hljs-keyword">label</span>:'hello concent'
    },
  },
});

class App extends React.Component{
  changeLabel = (e)=&gt;{
    this.<span class="hljs-built_in">set</span>State({<span class="hljs-keyword">label</span>: e.currentTarget.value});
  }
  render(){
    const <span class="hljs-keyword">label</span> = this.<span class="hljs-keyword">state</span>.<span class="hljs-keyword">label</span>;
    return (
      <span class="hljs-variable">&lt;div&gt;</span>
        {<span class="hljs-keyword">label</span>}<span class="hljs-variable">&lt;br/&gt;</span>
        <span class="hljs-variable">&lt;input value={label} onChange={this.changeLabel} /&gt;</span>
      &lt;/div&gt;
    )
  }
}
const App_ = register('App', {module:'foo', sharedStateKeys:'*'})(App);
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="状态共享"></a><a href="#状态共享" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>状态共享</h3>
<p>上述演示的古典写法里，除了修改<code>foo</code>模块的<code>label</code>值，似乎并没有看出其他不同之处，我们仔细看<code>register</code>函数里，传入了一个<code>sharedStateKeys</code>，正如其名字描述的一样，表示当前concent类的实例将共享<code>foo</code>模块的所有<code>key</code>的值，既然是共享，那么只要任意一个实例修改了<code>foo</code>下的任意<code>key</code>的值，那么其他实例都将获得最新的修改值并被触发渲染。</p>
<p><a href="https://stackblitz.com/edit/cc-course-classic-writing-and-state-been-shared?file=index.js">在线示例</a></p>
<pre><code class="hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
  changeLabel = <span class="hljs-function">(<span class="hljs-params">e</span>)=&gt;</span>{
    <span class="hljs-keyword">this</span>.setState({<span class="hljs-attr">label</span>: e.currentTarget.value});
  }
  render(){
    <span class="hljs-keyword">const</span> label = <span class="hljs-keyword">this</span>.state.label;
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        {label}<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{label}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{this.changeLabel}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    )
  }
}
const Foo_ = register('Foo', {module:'foo', sharedStateKeys:'*'})(Foo);

const App = ()=&gt;{
  return (
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Foo</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Foo</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Foo</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  );
}
</span></code></pre>
<blockquote>
<p>以上三个<code>Foo</code>实例，任意一个修改<code>label</code>值，都会同步到其他两个实例上</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="reducer"></a><a href="#reducer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>reducer</h2>
<p><code>reducer</code>函数用于书写用户的业务逻辑并返回新的片段状态，提高代码的复用性，并将视图渲染和业务逻辑彻底隔离，更多关于<code>reducer</code>的定义<a href="doc-core-reducer">请跳转此处查看</a></p>
<h2><a class="anchor" aria-hidden="true" id="watch"></a><a href="#watch" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>watch</h2>
<p><code>watch</code>允许用户观察某些<code>key</code>的变化书写一些异步逻辑</p>
<blockquote>
<p>典型的场景1，导航组件切换标签页，对应的路由组件需要刷新的逻辑，导航组件负责跟上tabId，其他组件负责观察tabId变化，并刷新对应tabId的数据<br /></p>
</blockquote>
<blockquote>
<p>典型的场景2, 类组件里，一个单选按钮组切换，类里定义watch观察并更新，注：这里指的是实例级别的watch函数，不同上面的模块级别的watch函数，但它们本质都一样:某些场景里，需要让数据的变化和业务逻辑解耦，就是你需要使用watch的时候</p>
</blockquote>
<pre><code class="hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span></span>{
  $$watch() {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">/** 观察到_duration发生变化，从后端获取最新数据 */</span>
      _duration: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.fetchStatData(<span class="hljs-keyword">this</span>.state._account);
      }
    }
  }
  render(){
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Group</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{_duration}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{this.$$sync(</span>'<span class="hljs-attr">_duration</span>')}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"day"</span>&gt;</span>日<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"week"</span>&gt;</span>周<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"month"</span>&gt;</span>月<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Group</span>&gt;</span></span>
    );
  }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="computed"></a><a href="#computed" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>computed</h2>
<p>对key定义computed后，concent调用这些key的computed函数结算出结果并将结果缓存起来，只有当key再次发生变化时，才会触发重计算</p>
<pre><code class="hljs">
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/concent-site/docs/doc-guid-standard-dev"><span class="arrow-prev">← </span><span>标准化的开发</span></a><a class="docs-next button" href="/concent-site/docs/doc-core-component"><span>组件</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#state">state</a><ul class="toc-headings"><li><a href="#状态定义">状态定义</a></li><li><a href="#状态合成">状态合成</a></li><li><a href="#状态连接">状态连接</a></li><li><a href="#状态修改">状态修改</a></li><li><a href="#状态共享">状态共享</a></li></ul></li><li><a href="#reducer">reducer</a></li><li><a href="#watch">watch</a></li><li><a href="#computed">computed</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/concent-site/" class="nav-home"><img src="/concent-site/img/favicon.ico" alt="concent" width="66" height="58"/></a><div><h5>Docs</h5><a href="/concent-site/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/concent-site/docs/en/doc2.html">Guides (or other categories)</a><a href="/concent-site/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/concent-site/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/concent-site/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/concent-site/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Your Name or Your Company Name</section></footer></div></body></html>